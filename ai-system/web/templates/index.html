{% extends "base.html" %}

{% block title %}Trang ch·ªß - AI Labeling System{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="text-center mb-4">
            <i class="fas fa-brain me-2"></i>AI Labeling System
            <small class="text-muted d-block">H·ªá th·ªëng ƒë√°nh nh√£n d·ªØ li·ªáu AI cho E-commerce</small>
        </h1>
    </div>
</div>

<!-- Upload Section -->
<div class="row mb-4">
    <div class="col-12">
        <div class="content-box text-center">
            <h5><i class="fas fa-upload me-2"></i>Upload D·ªØ Li·ªáu</h5>
            <p class="text-muted">Import d·ªØ li·ªáu t·ª´ file CSV ƒë·ªÉ b·∫Øt ƒë·∫ßu ƒë√°nh nh√£n</p>
            <a href="/upload" class="btn btn-primary btn-custom">
                <i class="fas fa-file-upload me-2"></i>Upload CSV Data
            </a>
        </div>
    </div>
</div>

<!-- Model Cards -->
<div class="row">
    <!-- Sentiment Analysis -->
    <div class="col-md-4">
        <div class="stats-card">
            <h5><i class="fas fa-heart me-2"></i>Sentiment Analysis</h5>
            <div class="row">
                <div class="col-6">
                    <small>Ch·ªù ƒë√°nh nh√£n: {{ stats.sentiment.pending if stats.sentiment else 0 }}</small>
                </div>
                <div class="col-6">
                    <small>ƒê√£ ƒë√°nh nh√£n: {{ stats.sentiment.labeled if stats.sentiment else 0 }}</small>
                </div>
            </div>
            <div class="mt-3">
                <a href="/labeling/sentiment" class="btn btn-light btn-sm me-2">
                    <i class="fas fa-edit me-1"></i>ƒê√°nh nh√£n
                </a>
                <button class="btn btn-outline-light btn-sm" onclick="trainModel('sentiment')">
                    <i class="fas fa-cogs me-1"></i>Training
                </button>
            </div>
        </div>
    </div>

    <!-- Chatbot -->
    <div class="col-md-4">
        <div class="stats-card">
            <h5><i class="fas fa-robot me-2"></i>Chatbot</h5>
            <div class="row">
                <div class="col-6">
                    <small>Ch·ªù ƒë√°nh nh√£n: {{ stats.chatbot.pending if stats.chatbot else 0 }}</small>
                </div>
                <div class="col-6">
                    <small>ƒê√£ ƒë√°nh nh√£n: {{ stats.chatbot.labeled if stats.chatbot else 0 }}</small>
                </div>
            </div>
            <div class="mt-3">
                <a href="/labeling/chatbot" class="btn btn-light btn-sm me-2">
                    <i class="fas fa-edit me-1"></i>ƒê√°nh nh√£n
                </a>
                <button class="btn btn-outline-light btn-sm" onclick="trainModel('chatbot')">
                    <i class="fas fa-cogs me-1"></i>Training
                </button>
            </div>
        </div>
    </div>

    <!-- Recommendation -->
    <div class="col-md-4">
        <div class="stats-card">
            <h5><i class="fas fa-thumbs-up me-2"></i>Recommendation</h5>
            <div class="row">
                <div class="col-6">
                    <small>Ch·ªù ƒë√°nh nh√£n: {{ stats.recommendation.pending if stats.recommendation else 0 }}</small>
                </div>
                <div class="col-6">
                    <small>ƒê√£ ƒë√°nh nh√£n: {{ stats.recommendation.labeled if stats.recommendation else 0 }}</small>
                </div>
            </div>
            <div class="mt-3">
                <a href="/labeling/recommendation" class="btn btn-light btn-sm me-2">
                    <i class="fas fa-edit me-1"></i>ƒê√°nh nh√£n
                </a>
                <button class="btn btn-outline-light btn-sm" onclick="trainModel('recommendation')">
                    <i class="fas fa-cogs me-1"></i>Training
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Statistics -->
<div class="row mt-4">
    <div class="col-12">
        <div class="content-box">
            <h5><i class="fas fa-chart-bar me-2"></i>Th·ªëng K√™ Chi Ti·∫øt</h5>
            <div class="row">
                <div class="col-md-3">
                    <div class="text-center">
                        <h3 class="text-primary">{{ stats.sentiment_labels or 0 }}</h3>
                        <small>Sentiment Labels</small>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="text-center">
                        <h3 class="text-success">{{ stats.chatbot_labels or 0 }}</h3>
                        <small>Chatbot Labels</small>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="text-center">
                        <h3 class="text-warning">{{ stats.recommendation_labels or 0 }}</h3>
                        <small>Recommendation Labels</small>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="text-center">
                        <h3 class="text-info">{{ (stats.sentiment_labels or 0) + (stats.chatbot_labels or 0) + (stats.recommendation_labels or 0) }}</h3>
                        <small>T·ªïng Labels</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Export Section -->
<div class="row mt-4">
    <div class="col-12">
        <div class="content-box">
            <h5><i class="fas fa-download me-2"></i>Export D·ªØ Li·ªáu ƒê√£ ƒê√°nh Nh√£n</h5>
            <p class="text-muted">T·∫£i xu·ªëng d·ªØ li·ªáu ƒë√£ ƒë√°nh nh√£n ƒë·ªÉ s·ª≠ d·ª•ng cho training models</p>
            <div class="btn-group" role="group">
                <button class="btn btn-success btn-custom" onclick="exportData('sentiment')">
                    <i class="fas fa-download me-1"></i>Export Sentiment
                </button>
                <button class="btn btn-success btn-custom" onclick="exportData('chatbot')">
                    <i class="fas fa-download me-1"></i>Export Chatbot
                </button>
                <button class="btn btn-success btn-custom" onclick="exportData('recommendation')">
                    <i class="fas fa-download me-1"></i>Export Recommendation
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Quick Start Guide -->
<div class="row mt-4">
    <div class="col-12">
        <div class="content-box">
            <h5><i class="fas fa-rocket me-2"></i>H∆∞·ªõng D·∫´n S·ª≠ D·ª•ng Nhanh</h5>
            <div class="row">
                <div class="col-md-4">
                    <h6><i class="fas fa-upload me-2"></i>1. Upload D·ªØ Li·ªáu</h6>
                    <p class="text-muted">Ch·ªçn file CSV c√≥ c·ªôt "text" v√† upload l√™n h·ªá th·ªëng</p>
                </div>
                <div class="col-md-4">
                    <h6><i class="fas fa-edit me-2"></i>2. ƒê√°nh Nh√£n</h6>
                    <p class="text-muted">Click v√†o t·ª´ng lo·∫°i model ƒë·ªÉ b·∫Øt ƒë·∫ßu ƒë√°nh nh√£n d·ªØ li·ªáu</p>
                </div>
                <div class="col-md-4">
                    <h6><i class="fas fa-cogs me-2"></i>3. Training</h6>
                    <p class="text-muted">Sau khi ƒë√°nh nh√£n, click "Training" ƒë·ªÉ train models</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function trainModel(modelType) {
    showAlert('info', `üöÄ ƒêang training ${modelType} model...`);
    
    axios.get(`/train/${modelType}`)
        .then(response => {
            if (response.data.success) {
                showAlert('success', `‚úÖ ${response.data.message}`);
                if (response.data.result.accuracy) {
                    showAlert('success', `üìä Accuracy: ${response.data.result.accuracy.toFixed(4)}`);
                } else if (response.data.result.mse) {
                    showAlert('success', `üìä MSE: ${response.data.result.mse.toFixed(4)}`);
                }
            } else {
                showAlert('danger', `‚ùå ${response.data.message}`);
            }
        })
        .catch(error => {
            showAlert('danger', `‚ùå Error: ${error.message}`);
        });
}

function exportData(dataType) {
    showAlert('info', `üì§ ƒêang export ${dataType} data...`);
    
    axios.get(`/export/${dataType}`)
        .then(response => {
            if (response.data.success) {
                // T·∫°o link download
                const link = document.createElement('a');
                link.href = response.data.download_url;
                link.download = `exported_${dataType}_labeled.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showAlert('success', `‚úÖ ${response.data.message}`);
            } else {
                showAlert('danger', `‚ùå ${response.data.message}`);
            }
        })
        .catch(error => {
            showAlert('danger', `‚ùå Error: ${error.message}`);
        });
}

function showAlert(type, message) {
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type} alert-dismissible fade show alert-custom`;
    alertDiv.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.querySelector('.main-container').insertBefore(alertDiv, document.querySelector('.row'));
    
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.remove();
        }
    }, 5000);
}

// Auto refresh stats every 30 seconds
setInterval(() => {
    axios.get('/api/stats')
        .then(response => {
            // Update stats display
            location.reload();
        })
        .catch(error => {
            console.log('Stats refresh failed:', error);
        });
}, 30000);
</script>
{% endblock %}
