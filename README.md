# 🛒 E-Commerce Backend API

## �� Tổng Quan

Đây là backend API cho hệ thống e-commerce được xây dựng bằng Node.js, Express.js và Prisma ORM. Hệ thống cung cấp các API endpoints cho quản lý sản phẩm, đơn hàng, người dùng và xác thực bảo mật.

## �� Tính Năng Đã Hoàn Thành

### ✅ Database & ORM
- **Prisma ORM** - Quản lý database với type safety
- **MySQL Database** - Cơ sở dữ liệu chính
- **Database Schema** - 20+ bảng với quan hệ đầy đủ
- **Migrations** - Quản lý thay đổi database
- **Seed Data** - Dữ liệu mẫu cho development

### ✅ Authentication & Security
- **JWT Authentication** - Xác thực bằng JSON Web Token
- **Password Hashing** - Mã hóa mật khẩu với bcrypt
- **Role-based Access Control** - Phân quyền ADMIN/STAFF
- **Rate Limiting** - Giới hạn số request
- **CORS Protection** - Bảo vệ cross-origin
- **Security Headers** - Helmet middleware
- **Input Validation** - Kiểm tra dữ liệu đầu vào

### ✅ API Endpoints
- **Health Check** - Kiểm tra trạng thái server
- **Database Test** - Kiểm tra kết nối database
- **Authentication** - Login, logout, profile
- **Error Handling** - Xử lý lỗi toàn diện
- **404 Handler** - Xử lý route không tồn tại

## 🏗️ Cấu Trúc Project
# 🛒 E-Commerce Backend API

## �� Tổng Quan

Đây là backend API cho hệ thống e-commerce được xây dựng bằng Node.js, Express.js và Prisma ORM. Hệ thống cung cấp các API endpoints cho quản lý sản phẩm, đơn hàng, người dùng và xác thực bảo mật.

## �� Tính Năng Đã Hoàn Thành

### ✅ Database & ORM
- **Prisma ORM** - Quản lý database với type safety
- **MySQL Database** - Cơ sở dữ liệu chính
- **Database Schema** - 20+ bảng với quan hệ đầy đủ
- **Migrations** - Quản lý thay đổi database
- **Seed Data** - Dữ liệu mẫu cho development

### ✅ Authentication & Security
- **JWT Authentication** - Xác thực bằng JSON Web Token
- **Password Hashing** - Mã hóa mật khẩu với bcrypt
- **Role-based Access Control** - Phân quyền ADMIN/STAFF
- **Rate Limiting** - Giới hạn số request
- **CORS Protection** - Bảo vệ cross-origin
- **Security Headers** - Helmet middleware
- **Input Validation** - Kiểm tra dữ liệu đầu vào

### ✅ API Endpoints
- **Health Check** - Kiểm tra trạng thái server
- **Database Test** - Kiểm tra kết nối database
- **Authentication** - Login, logout, profile
- **Error Handling** - Xử lý lỗi toàn diện
- **404 Handler** - Xử lý route không tồn tại

## 🏗️ Cấu Trúc Project
# 🛒 E-Commerce Backend API

## �� Tổng Quan

Đây là backend API cho hệ thống e-commerce được xây dựng bằng Node.js, Express.js và Prisma ORM. Hệ thống cung cấp các API endpoints cho quản lý sản phẩm, đơn hàng, người dùng và xác thực bảo mật.

## �� Tính Năng Đã Hoàn Thành

### ✅ Database & ORM
- **Prisma ORM** - Quản lý database với type safety
- **MySQL Database** - Cơ sở dữ liệu chính
- **Database Schema** - 20+ bảng với quan hệ đầy đủ
- **Migrations** - Quản lý thay đổi database
- **Seed Data** - Dữ liệu mẫu cho development

### ✅ Authentication & Security
- **JWT Authentication** - Xác thực bằng JSON Web Token
- **Password Hashing** - Mã hóa mật khẩu với bcrypt
- **Role-based Access Control** - Phân quyền ADMIN/STAFF
- **Rate Limiting** - Giới hạn số request
- **CORS Protection** - Bảo vệ cross-origin
- **Security Headers** - Helmet middleware
- **Input Validation** - Kiểm tra dữ liệu đầu vào

### ✅ API Endpoints
- **Health Check** - Kiểm tra trạng thái server
- **Database Test** - Kiểm tra kết nối database
- **Authentication** - Login, logout, profile
- **Error Handling** - Xử lý lỗi toàn diện
- **404 Handler** - Xử lý route không tồn tại

## 🏗️ Cấu Trúc Project
# 🛒 E-Commerce Backend API

## �� Tổng Quan

Đây là backend API cho hệ thống e-commerce được xây dựng bằng Node.js, Express.js và Prisma ORM. Hệ thống cung cấp các API endpoints cho quản lý sản phẩm, đơn hàng, người dùng và xác thực bảo mật.

## �� Tính Năng Đã Hoàn Thành

### ✅ Database & ORM
- **Prisma ORM** - Quản lý database với type safety
- **MySQL Database** - Cơ sở dữ liệu chính
- **Database Schema** - 20+ bảng với quan hệ đầy đủ
- **Migrations** - Quản lý thay đổi database
- **Seed Data** - Dữ liệu mẫu cho development

### ✅ Authentication & Security
- **JWT Authentication** - Xác thực bằng JSON Web Token
- **Password Hashing** - Mã hóa mật khẩu với bcrypt
- **Role-based Access Control** - Phân quyền ADMIN/STAFF
- **Rate Limiting** - Giới hạn số request
- **CORS Protection** - Bảo vệ cross-origin
- **Security Headers** - Helmet middleware
- **Input Validation** - Kiểm tra dữ liệu đầu vào

### ✅ API Endpoints
- **Health Check** - Kiểm tra trạng thái server
- **Database Test** - Kiểm tra kết nối database
- **Authentication** - Login, logout, profile
- **Error Handling** - Xử lý lỗi toàn diện
- **404 Handler** - Xử lý route không tồn tại

## 🏗️ Cấu Trúc Project
backend/
├── config/ # Cấu hình
│ ├── jwt.js # JWT configuration
│ ├── database.js # Database config
│ └── cloudinary.js # Cloudinary config
├── controller/ # Controllers
│ └── authController.js # Authentication controller
├── middleware/ # Middleware
│ └── auth.js # Authentication middleware
├── routes/ # API Routes
│ └── authRoutes.js # Authentication routes
├── prisma/ # Prisma ORM
│ ├── schema.prisma # Database schema
│ ├── seed.js # Seed data
│ └── migrations/ # Database migrations
├── utils/ # Utility functions
├── services/ # Business logic
├── validations/ # Input validation
├── server.js # Main server file
├── package.json # Dependencies
└── .env # Environment variables


## 🛠️ Cài Đặt & Chạy

### 1. Cài Đặt Dependencies

```bash
npm install
```

### 2. Cấu Hình Environment

Tạo file `.env` trong thư mục `backend`:

```env
# Database
DATABASE_URL="mysql://root:password@localhost:3306/ecommerce_db"

# JWT
JWT_SECRET=your-super-secret-jwt-key-change-in-production-123456789
JWT_EXPIRES_IN=24h
JWT_REFRESH_EXPIRES_IN=7d

# Server
PORT=5000
NODE_ENV=development

# Frontend
FRONTEND_URL=http://localhost:3000
```

### 3. Setup Database

```bash
# Generate Prisma client
npx prisma generate

# Run migrations
npx prisma migrate dev

# Seed database
npm run seed
```

### 4. Chạy Server

```bash
# Development mode
npm run dev

# Production mode
npm start
```

## 📚 API Documentation

### Base URL
http://localhost:5000/api


### Authentication Endpoints

#### POST /auth/login
Đăng nhập admin

**Request:**
```json
{
  "email": "admin@ecommerce.com",
  "password": "admin123"
}
```

**Response:**
```json
{
  "success": true,
  "message": "Đăng nhập thành công",
  "data": {
    "user": {
      "id": 1,
      "email": "admin@ecommerce.com",
      "firstName": "Admin",
      "lastName": "Admin",
      "role": "ADMIN",
      "isActive": true
    },
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
}
```

#### GET /auth/profile
Lấy thông tin profile (cần token)

**Headers:**
Authorization: Bearer YOUR_TOKEN_HERE

**Response:**
```json
{
  "success": true,
  "message": "Đăng xuất thành công"
}
```

### System Endpoints

#### GET /health
Kiểm tra trạng thái server

**Response:**
```json
{
  "success": true,
  "message": "Server is running",
  "timestamp": "2025-09-12T02:39:14.412Z"
}
```

#### GET /test-db
Kiểm tra kết nối database

**Response:**
```json
{
  "success": true,
  "message": "Database connected successfully"
}
```

## 🧪 Testing

### Chạy Test Suite

```bash
# Test toàn bộ hệ thống
node test-auth.js
```

### Test Manual với cURL

```bash
# Health check
curl http://localhost:5000/api/health

# Database test
curl http://localhost:5000/api/test-db

# Login
curl -X POST http://localhost:5000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@ecommerce.com","password":"admin123"}'

# Profile (thay YOUR_TOKEN bằng token thực)
curl http://localhost:5000/api/auth/profile \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## �� Bảo Mật

### JWT Token
- **Access Token**: Hết hạn sau 24h
- **Refresh Token**: Hết hạn sau 7 ngày
- **Algorithm**: HS256

### Rate Limiting
- **Window**: 15 phút
- **Max Requests**: 100 requests per window
- **Message**: "Quá nhiều requests, vui lòng thử lại sau"

### Password Security
- **Hashing**: bcrypt với salt rounds = 10
- **Validation**: Tối thiểu 6 ký tự

## 📊 Database Schema

### Các Bảng Chính

#### Admin & Users
- `admin_users` - Quản trị viên
- `users` - Khách hàng
- `otp_verifications` - Xác thực OTP
- `password_resets` - Reset mật khẩu

#### Products & Categories
- `categories` - Danh mục sản phẩm
- `brands` - Thương hiệu
- `products` - Sản phẩm
- `product_specifications` - Thông số kỹ thuật
- `product_images` - Hình ảnh sản phẩm
- `product_variants` - Biến thể sản phẩm

#### Orders & Payments
- `orders` - Đơn hàng
- `order_items` - Chi tiết đơn hàng
- `payments` - Thanh toán
- `coupons` - Mã giảm giá
- `coupon_usage` - Lịch sử sử dụng coupon

#### User Experience
- `shopping_cart` - Giỏ hàng
- `wishlist` - Danh sách yêu thích
- `product_comments` - Bình luận
- `product_reviews` - Đánh giá
- `notifications` - Thông báo

## �� Deployment

### Environment Variables

```env
# Production
NODE_ENV=production
PORT=5000
DATABASE_URL="mysql://user:password@host:port/database"
JWT_SECRET="your-super-secret-production-key"
FRONTEND_URL="https://your-frontend-domain.com"
```

### Docker (Optional)

```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY . .
RUN npx prisma generate
EXPOSE 5000
CMD ["npm", "start"]
```

## 📝 Scripts

```bash
# Development
npm run dev          # Chạy với nodemon

# Production
npm start            # Chạy production

# Database
npm run seed         # Chạy seed data
npx prisma studio    # Mở Prisma Studio
npx prisma migrate dev # Chạy migration
```

## 🔧 Troubleshooting

### Lỗi Thường Gặp

1. **Database Connection Failed**
   - Kiểm tra DATABASE_URL trong .env
   - Đảm bảo MySQL đang chạy
   - Kiểm tra credentials

2. **JWT Token Invalid**
   - Kiểm tra JWT_SECRET trong .env
   - Đảm bảo token chưa hết hạn
   - Kiểm tra format Authorization header

3. **Rate Limit Exceeded**
   - Đợi 15 phút hoặc tăng limit trong config
   - Kiểm tra IP có bị block không

## �� Performance

### Optimizations
- **Connection Pooling** - Prisma connection pool
- **Rate Limiting** - Bảo vệ server
- **Input Validation** - Giảm lỗi processing
- **Error Handling** - Graceful error responses

### Monitoring
- **Health Check** - `/api/health`
- **Database Status** - `/api/test-db`
- **Logging** - Console logs với timestamps

## 🤝 Contributing

1. Fork repository
2. Tạo feature branch
3. Commit changes
4. Push to branch
5. Tạo Pull Request

## 📄 License

ISC License

## 👥 Team

- **Backend Developer** - Authentication & API
- **Database Designer** - Schema & Relations
- **Security Engineer** - JWT & Validation

---

## 📞 Support

Nếu gặp vấn đề, vui lòng tạo issue hoặc liên hệ team development.

**Last Updated**: 2025-09-12
**Version**: 1.0.0
**Status**: ✅ Production Ready